@model AchuBan_ECom.Models.Models.Product

@{
    ViewData["Title"] = Model?.Name ?? "Product";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container py-4">
    <div class="row">
        <div class="col-md-6">
            @if (!string.IsNullOrEmpty(Model.ImageUrl))
            {
                <img src="@Model.ImageUrl" alt="@Model.Name" class="img-fluid rounded shadow-sm" style="width:100%;object-fit:cover;max-height:480px" />
            }
            else
            {
                <div class="bg-light d-flex align-items-center justify-content-center rounded" style="height:480px">
                    <i class="bi bi-image" style="font-size:4rem;color:#d0d0d0"></i>
                </div>
            }
        </div>

        <div class="col-md-6">
            <h1 class="h4 mb-2">@Model.Name</h1>
            <p class="text-muted mb-1">By @Model.Author</p>
            <p class="mb-3"><strong>ISBN:</strong> @Model.ISBN</p>
            <h3 class="text-primary mb-3">@String.Format("{0:C}", Model.ListPrice)</h3>

            <div class="mb-3">
                <label class="form-label">Quantity</label>
                <input id="qty" type="number" min="1" value="1" class="form-control w-25" />
            </div>

            <div class="mb-4">
                <button id="addToCartBtn" class="btn btn-success btn-lg me-2">Add to cart</button>
                <a asp-area="Customer" asp-controller="Home" asp-action="Index" class="btn btn-outline-secondary">Back to Shop</a>
            </div>

            <dl class="row">
                <dt class="col-sm-4">Description</dt>
                <dd class="col-sm-8">@Html.Raw(Model.Description)</dd>

                <dt class="col-sm-4">Price for 50+</dt>
                <dd class="col-sm-8">@String.Format("{0:C}", Model.Price50)</dd>

                <dt class="col-sm-4">Price for 100+</dt>
                <dd class="col-sm-8">@String.Format("{0:C}", Model.Price100)</dd>

                <dt class="col-sm-4">Category</dt>
                <dd class="col-sm-8">@(Model.category?.Name ?? "—")</dd>
            </dl>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById('addToCartBtn').addEventListener('click', function () {
            var qty = parseInt(document.getElementById('qty').value || '1', 10);
            if (qty < 1) qty = 1;

            var item = {
                productId: @Model.Id,
                name: '@Model.Name'.replace(/'/g, "\\'"),
                price: @Model.ListPrice,
                quantity: qty,
                imageUrl: '@(Model.ImageUrl ?? "")'
            };

            var cart = JSON.parse(localStorage.getItem('cart') || '[]');
            var existing = cart.find(i => i.productId === item.productId);
            if (existing) {
                existing.quantity += item.quantity;
            } else {
                cart.push(item);
            }
            localStorage.setItem('cart', JSON.stringify(cart));

            if (window.toastr) {
                toastr.success('Added to cart');
            } else {
                alert('Added to cart');
            }
        });
    </script>
}